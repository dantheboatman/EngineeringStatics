(self.webpackChunkWebComponents=self.webpackChunkWebComponents||[]).push([[759],{32552:()=>{$.i18n().load({en:{msg_dragndrop_correct_answer:"You are correct!",msg_dragndrop_incorrect_answer:"Incorrect. You got $1 correct and $2 incorrect out of $3. You left $4 unmatched.",msg_dragndrop_check_me:"Check me",msg_dragndrop_reset:"Reset"}})},81264:()=>{$.i18n().load({"pt-br":{msg_dragndrop_correct_answer:"Correto!",msg_dragndrop_incorrect_answer:"Incorreto. Você teve $1 correto(s) e $2 incorreto(s) de $3. Você deixou $4 em branco.",msg_dragndrop_check_me:"Verificar",msg_dragndrop_reset:"Resetar"}})},56759:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});var r=i(78673);i(32552),i(81264);class s extends r.A{constructor(t){super(t);var e=t.orig;this.origElem=e,this.divid=e.id,this.useRunestoneServices=t.useRunestoneServices,this.random=!1,this.origElem.hasAttribute("data-random")&&(this.random=!0),this.feedback="",this.question="",this.populate(),this.createNewElements(),this.caption="Drag-N-Drop",this.addCaption("runestone"),"undefined"!=typeof Prism&&Prism.highlightAllUnder(this.containerDiv)}populate(){this.responseArray=[],this.premiseArray=[];for(let t of this.origElem.querySelectorAll("[data-subcomponent='draggable']")){let e=document.createElement("span");e.innerHTML=t.innerHTML,e.id=t.id,e.setAttribute("draggable","true"),e.classList.add("draggable-drag"),e.classList.add("premise"),e.dataset.category=this.getCategory(t),e.dataset.parent_id=this.divid,this.premiseArray.push(e),this.setDragListeners(e)}this.premiseArray=a(this.premiseArray);for(let t of this.origElem.querySelectorAll("[data-subcomponent='dropzone']")){let e=document.createElement("span");e.innerHTML=t.innerHTML,e.id=t.getAttribute("for").replace("drag","drop"),e.classList.add("draggable-drop","drop-label","response"),e.dataset.category=this.getCategory(t),e.dataset.parent_id=this.divid,this.responseArray.push(e),this.setDropListeners(e)}this.question=this.origElem.querySelector("[data-subcomponent='question']").innerHTML;let t=this.origElem.querySelector("[data-subcomponent='feedback']");t&&(this.feedback=t.innerHTML)}getCategory(t){return t.dataset.category?t.dataset.category:t.hasAttribute("for")?t.getAttribute("for"):t.id}createNewElements(){this.containerDiv=document.createElement("div"),this.containerDiv.id=this.divid,this.containerDiv.classList.add("draggable-container"),this.containerDiv.innerHTML=this.question,this.containerDiv.appendChild(document.createElement("br")),this.dragDropWrapDiv=document.createElement("div"),this.dragDropWrapDiv.style.display="block",this.containerDiv.appendChild(this.dragDropWrapDiv),this.draggableDiv=document.createElement("div"),this.draggableDiv.classList.add("rsdraggable","dragzone"),this.addDragDivListeners(),this.dropZoneDiv=document.createElement("div"),this.dropZoneDiv.classList.add("rsdraggable"),this.dragDropWrapDiv.appendChild(this.draggableDiv),this.dragDropWrapDiv.appendChild(this.dropZoneDiv),this.createButtons(),this.checkServer("dragNdrop",!0),eBookConfig.practice_mode&&this.finishSettingUp(),self=this,this.ivp=this.isValidPremise.bind(this),self.queueMathJax(self.containerDiv)}finishSettingUp(){this.appendReplacementSpans(),this.createFeedbackDiv(),this.origElem.parentNode.replaceChild(this.containerDiv,this.origElem),this.hasStoredDropzones||(this.minheight=this.draggableDiv.offsetHeight,this.queueMathJax(this.containerDiv).then((()=>{this.adjustDragDropWidths()}))),this.draggableDiv.style.minHeight=this.minheight.toString()+"px",this.dropZoneDiv.offsetHeight>this.minheight?this.dragDropWrapDiv.style.minHeight=this.dropZoneDiv.offsetHeight.toString()+"px":this.dragDropWrapDiv.style.minHeight=this.minheight.toString()+"px",this.draggableDiv.style.width=`${this.dragwidth}%`,this.dropZoneDiv.style.width=`${this.dropwidth}%`}addDragDivListeners(){let t=this;this.draggableDiv.addEventListener("dragover",function(t){t.preventDefault(),this.draggableDiv.classList.contains("possibleDrop")||this.draggableDiv.classList.add("possibleDrop")}.bind(this)),this.draggableDiv.addEventListener("drop",function(e){t.isAnswered=!0,e.preventDefault(),this.draggableDiv.classList.contains("possibleDrop")&&this.draggableDiv.classList.remove("possibleDrop");var i=e.dataTransfer.getData("draggableID"),r=document.getElementById(i);this.draggableDiv.contains(r)||this.strangerDanger(r)||(this.draggableDiv.appendChild(r),this.adjustDragDropWidths(),this.minheight=this.draggableDiv.offsetHeight,this.dragDropWrapDiv.style.minHeight=this.minheight.toString()+"px")}.bind(this)),this.draggableDiv.addEventListener("dragleave",function(t){this.draggableDiv.classList.contains("possibleDrop")&&this.draggableDiv.classList.remove("possibleDrop")}.bind(this))}createButtons(){this.buttonDiv=document.createElement("div"),this.buttonDiv.classList.add("dnd-button-container"),this.submitButton=document.createElement("button"),this.submitButton.textContent=$.i18n("msg_dragndrop_check_me"),this.submitButton.setAttribute("class","btn btn-success drag-button"),this.submitButton.setAttribute("name","do answer"),this.submitButton.setAttribute("type","button"),this.submitButton.onclick=function(){this.checkCurrentAnswer(),this.renderFeedback(),this.logCurrentAnswer()}.bind(this),this.resetButton=document.createElement("button"),this.resetButton.textContent=$.i18n("msg_dragndrop_reset"),this.resetButton.setAttribute("class","btn btn-default drag-button drag-reset"),this.resetButton.setAttribute("name","do answer"),this.resetButton.onclick=function(){this.resetDraggables()}.bind(this),this.buttonDiv.appendChild(this.submitButton),this.buttonDiv.appendChild(this.resetButton),this.containerDiv.appendChild(this.buttonDiv)}appendReplacementSpans(){if(void 0===this.answerState||0===Object.keys(this.answerState).length){this.answerState={};for(let t of this.premiseArray)this.draggableDiv.appendChild(t);for(let t of this.responseArray)this.dropZoneDiv.appendChild(t)}else{let t=[];for(let e of this.responseArray)if(this.dropZoneDiv.appendChild(e),this.answerState[e.id])for(let i of this.answerState[e.id])t.push(i),e.appendChild(this.findPremise(i));for(let e of this.premiseArray)-1==t.indexOf(e.id)&&this.draggableDiv.appendChild(e)}}findPremise(t){for(let e of this.premiseArray)if(e.id==t)return e}setDragListeners(t){let e=this;t.addEventListener("dragstart",(function(t){t.dataTransfer.setData("draggableID",t.target.id)})),t.addEventListener("dragover",(function(t){t.preventDefault()})),t.addEventListener("drop",function(t){e.isAnswered=!0,t.preventDefault();var i=t.dataTransfer.getData("draggableID"),r=document.getElementById(i);r==t.target||this.strangerDanger(r)||this.draggableDiv.appendChild(r)}.bind(this))}setDropListeners(t){t.addEventListener("dragover",function(t){self.isAnswered=!0,t.preventDefault(),t.target.classList.contains("possibleDrop")||t.target.classList.contains("draggable-drop")&&t.target.classList.add("possibleDrop")}.bind(this)),t.addEventListener("dragleave",(function(t){self.isAnswered=!0,t.preventDefault(),t.target.classList.contains("possibleDrop")&&t.target.classList.remove("possibleDrop")})),t.addEventListener("drop",function(t){self.isAnswered=!0,t.preventDefault(),t.target.classList.contains("possibleDrop")&&t.target.classList.remove("possibleDrop");var e=t.dataTransfer.getData("draggableID"),i=document.getElementById(e);!t.target.classList.contains("draggable-drop")||this.strangerDanger(i)||this.premiseArray.includes(t.target)||t.target.appendChild(i),this.queueMathJax(this.containerDiv).then((()=>{this.adjustDragDropWidths()}))}.bind(this))}adjustDragDropWidths(){this.draggableDiv.style.width="fit-content";const t=this.draggableDiv.offsetWidth,e=this.dragDropWrapDiv.offsetWidth;let i=Math.ceil(t/e*100);i=Math.max(28,Math.min(i,48));const r=100-i-4;this.dragwidth=i,this.dropwidth=r,this.draggableDiv.style.width=`${i}%`,this.dropZoneDiv.style.width=`${r}%`}createFeedbackDiv(){this.feedBackDiv||(this.feedBackDiv=document.createElement("div"),this.feedBackDiv.id=this.divid+"_feedback",this.feedBackDiv.setAttribute("aria-live","polite"),this.feedBackDiv.setAttribute("role","status"),this.containerDiv.appendChild(document.createElement("br")),this.containerDiv.appendChild(this.feedBackDiv))}strangerDanger(t){return t.dataset.parent_id!=this.divid}resetDraggables(){this.dropZoneDiv.innerHTML="";for(let t of this.responseArray)t.classList.remove("drop-incorrect"),this.dropZoneDiv.appendChild(t);this.draggableDiv.innerHTML="",a(this.premiseArray);for(let t of this.premiseArray)this.draggableDiv.appendChild(t);this.answerState={},this.feedBackDiv.style.display="none",this.adjustDragDropWidths(),this.minheight=this.draggableDiv.offsetHeight,this.dragDropWrapDiv.style.minHeight=this.minheight.toString()+"px",this.feedBackDiv.style.visibility="hidden"}getAllCategories(){this.categories=[];for(let t of this.dropZoneDiv.childNodes)this.categories.push(t.dataset.category);return this.categories}checkCurrentAnswer(){let t=this.getAllCategories();this.correct=!0,this.unansweredNum=0,this.incorrectNum=0,this.correctNum=0,this.dragNum=this.premiseArray.length;for(let t of this.dropZoneDiv.childNodes)for(let e of Array.from(t.childNodes).filter(this.ivp))e.dataset.category==t.dataset.category?this.correctNum++:this.incorrectNum++;for(let e of Array.from(this.draggableDiv.childNodes).filter((t=>t.nodeType!==Node.TEXT_NODE)))-1==t.indexOf(e.dataset.category)?this.correctNum++:this.unansweredNum++;this.percent=this.correctNum/this.premiseArray.length,console.log(this.percent,this.incorrectNum,this.unansweredNum),this.percent<1&&(this.correct=!1),this.setLocalStorage({correct:this.correct?"T":"F"})}isCorrectDrop(t){let e=!0,i=0;for(let r of Array.from(t.childNodes).filter(this.ivp))r.dataset.category!=t.dataset.category?e=!1:i++;let r=0;for(let e of this.premiseArray)e.dataset.category==t.dataset.category&&r++;return e&&i==r}isValidPremise(t){return!!this.premiseArray.includes(t)}async logCurrentAnswer(t){let e=JSON.stringify(this.answerState),i={event:"dragNdrop",act:e,answer:e,min_height:Math.round(this.minheight),drag_width:this.dragwidth,drop_width:this.dropwidth,div_id:this.divid,correct:this.correct,correctNum:this.correctNum,dragNum:this.dragNum};void 0!==t&&(i.sid=t),await this.logBookEvent(i)}renderFeedback(){for(let t of this.dropZoneDiv.childNodes)this.isCorrectDrop(t)?t.classList.remove("drop-incorrect"):t.classList.add("drop-incorrect");if(this.feedBackDiv||this.createFeedbackDiv(),this.feedBackDiv.style.visibility="visible",this.correct){var t=$.i18n("msg_dragndrop_correct_answer");setTimeout((()=>{this.feedBackDiv.innerHTML=t}),10),this.feedBackDiv.className="alert alert-info draggable-feedback"}else{var e=$.i18n($.i18n("msg_dragndrop_incorrect_answer"),this.correctNum,this.incorrectNum,this.dragNum,this.unansweredNum);setTimeout((()=>{this.feedBackDiv.innerHTML=e+" "+this.feedback}),10),this.feedBackDiv.className="alert alert-danger draggable-feedback"}}restoreAnswers(t){this.hasStoredDropzones=!0,this.minheight=t.min_height,this.dragwidth=t.drag_width,this.dropwidth=t.drop_width,this.answerState=JSON.parse(t.answer),this.finishSettingUp()}checkLocalStorage(){if(!this.graderactive){var t;if(this.hasStoredDropzones=!1,localStorage.length>0){var e=localStorage.getItem(this.localStorageKey());if(null!==e){this.hasStoredDropzones=!0;try{t=JSON.parse(e),this.minheight=t.min_height,this.dragwidth=t.drag_width,this.dropwidth=t.drop_width}catch(t){return console.log(t.message),localStorage.removeItem(this.localStorageKey()),this.hasStoredDropzones=!1,void this.finishSettingUp()}if(this.answerState=t.answer,this.useRunestoneServices){let e=JSON.stringify(this.answerState);this.logBookEvent({event:"dragNdrop",act:e,answer:e,min_height:Math.round(this.minheight),drag_width:this.dragwidth,drop_width:this.dropwidth,div_id:this.divid,correct:t.correct})}}}this.finishSettingUp()}}setLocalStorage(t){if(void 0===t.answer){this.answerState={};for(let t of this.dropZoneDiv.childNodes){this.answerState[t.id]=[];for(let e of t.childNodes)e.nodeType!==Node.TEXT_NODE&&this.premiseArray.includes(e)&&this.answerState[t.id].push(e.id)}}var e=new Date,i=t.correct,r={answer:this.answerState,min_height:this.minheight,timestamp:e,correct:i,drag_width:this.dragwidth,drop_width:this.dropwidth};localStorage.setItem(this.localStorageKey(),JSON.stringify(r))}disableInteraction(){this.resetButton.style.display="none";for(var t=0;t<this.premiseArray.length;t++)this.premiseArray[t].draggable=!1,this.premiseArray[t].style.cursor="initial"}}function a(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}return t}document.addEventListener("runestone:login-complete",(function(){document.querySelectorAll("[data-component=dragndrop]").forEach((t=>{const e={orig:t,useRunestoneServices:eBookConfig.useRunestoneServices};if(!t.closest("[data-component=timedAssessment]"))try{window.componentMap[t.id]=new s(e)}catch(e){console.log(`Error rendering DragNDrop Problem ${t.id}: ${e}`)}}))}));class n extends s{constructor(t){super(t),this.finishSettingUp(),this.renderTimedIcon(this.containerDiv),this.hideButtons()}hideButtons(){$(this.submitButton).hide()}renderTimedIcon(t){var e=document.createElement("div"),i=document.createElement("img");$(i).attr({src:"../_static/clock.png",style:"width:15px;height:15px"}),e.className="timeTip",e.title="",e.appendChild(i),$(t).prepend(e)}checkCorrectTimed(){switch(this.unansweredNum===this.dragPairArray.length&&(this.correct=null),this.correct){case!0:return"T";case!1:return"F";default:return null}}hideFeedback(){$(this.feedBackDiv).hide()}}void 0===window.component_factory&&(window.component_factory={}),window.component_factory.dragndrop=function(t){return t.timed?new n(t):new s(t)}}}]);
//# sourceMappingURL=759.js.map