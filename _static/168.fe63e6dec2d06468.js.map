{"version":3,"file":"168.fe63e6dec2d06468.js","mappings":"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","sources":["webpack://WebComponents/./runestone/poll/js/poll.js"],"sourcesContent":["/*\n__author__ = Kirby Olson\n__date__ = 6/12/2015  */\n\"use strict\";\n\nimport RunestoneBase from \"../../common/js/runestonebase.js\";\nimport \"../css/poll.css\";\n\n\nexport default class Poll extends RunestoneBase {\n    constructor(opts) {\n        super(opts);\n        var orig = opts.orig; //entire <p> element\n        this.origElem = orig;\n        this.divid = orig.id;\n        this.children = this.origElem.childNodes;\n        this.optionList = [];\n        this.optsArray = [];\n        this.comment = false;\n        if (this.origElem.hasAttribute(\"data-comment\")) {\n            this.comment = true;\n        }\n        this.resultsViewer = this.origElem.getAttribute(\"data-results\");\n        this.getQuestionText();\n        this.getOptionText(); //populates optionList\n        this.renderPoll(); //generates HTML\n        // Checks localStorage to see if this poll has already been completed by this user.\n        this.checkPollStorage();\n        this.caption = \"Poll\";\n        this.addCaption(\"runestone\");\n    }\n    getQuestionText() {\n        //finds the text inside the parent tag, but before the first <li> tag and sets it as the question\n        var _this = this;\n        var firstAnswer;\n        for (var i = 0; i < this.children.length; i++) {\n            if (this.children[i].tagName == \"LI\") {\n                firstAnswer = _this.children[i];\n                break;\n            }\n        }\n        var delimiter = firstAnswer.outerHTML;\n        var fulltext = this.origElem.innerHTML;\n        var temp = fulltext.split(delimiter);\n        this.question = temp[0];\n    }\n    getOptionText() {\n        //Gets the text from each <li> tag and places it in this.optionList\n        var _this = this;\n        for (var i = 0; i < this.children.length; i++) {\n            if (_this.children[i].tagName == \"LI\") {\n                _this.optionList.push(_this.children[i].innerHTML);\n            }\n        }\n    }\n    renderPoll() {\n        //generates the HTML that the user interacts with\n        var _this = this;\n        this.containerDiv = document.createElement(\"div\");\n        this.pollForm = document.createElement(\"form\");\n        this.resultsDiv = document.createElement(\"div\");\n        this.resultsDiv.classList.add(\"poll-results\");\n        this.containerDiv.id = this.divid;\n        const origClass = this.origElem.getAttribute(\"class\");\n        if (origClass) {\n            this.containerDiv.classList.add(...origClass.split(\" \").filter(Boolean));\n        }\n        this.pollForm.innerHTML = `<div class=\"exercise-statement\">${this.question}</div>`;\n        this.pollForm.id = this.divid + \"_form\";\n        this.pollForm.method = \"get\";\n        this.pollForm.action = \"\";\n        this.pollForm.onsubmit = function () { return false; };\n        this.pollFieldset = document.createElement(\"fieldset\");\n        this.pollForm.appendChild(this.pollFieldset);\n        for (var i = 0; i < this.optionList.length; i++) {\n            let label = document.createElement(\"label\");\n            label.classList.add(\"poll-option\");\n            label.innerHTML += this.optionList[i]; // text content\n            var radio = document.createElement(\"input\");\n            var tmpid = _this.divid + \"_opt_\" + i;\n            radio.id = tmpid;\n            radio.name = this.divid + \"_group1\";\n            radio.type = \"radio\";\n            radio.value = i;\n            radio.classList.add(\"poll-choice-input\");\n            radio.addEventListener(\"click\", this.submitPoll.bind(this));\n            label.prepend(radio);\n            this.pollFieldset.appendChild(label);\n            this.optsArray.push(radio);\n        }\n\n        if (this.comment) {\n            this.renderTextField();\n        }\n        this.resultsDiv.id = this.divid + \"_results\";\n        this.containerDiv.appendChild(this.pollForm);\n        this.containerDiv.appendChild(this.resultsDiv);\n        this.origElem.replaceWith(this.containerDiv);\n        this.queueMathJax(this.containerDiv);\n    }\n    renderTextField() {\n        this.textfield = document.createElement(\"input\");\n        this.textfield.type = \"text\";\n        this.textfield.classList.add(\"form-control\");\n        this.textfield.style.width = \"300px\";\n        this.textfield.name = this.divid + \"_comment\";\n        this.textfield.placeholder = \"Any comments?\";\n        this.pollForm.appendChild(this.textfield);\n        this.pollForm.appendChild(document.createElement(\"br\"));\n    }\n    async submitPoll() {\n        //checks the poll, sets localstorage and submits to the server\n        var poll_val = null;\n        for (var i = 0; i < this.optsArray.length; i++) {\n            if (this.optsArray[i].checked) {\n                poll_val = this.optsArray[i].value;\n                break;\n            }\n        }\n        if (poll_val === null) return;\n        var comment_val = \"\";\n        if (this.comment) {\n            comment_val = this.textfield.value;\n        }\n        var act = \"\";\n        if (comment_val !== \"\") {\n            act = poll_val + \":\" + comment_val;\n        } else {\n            act = poll_val;\n        }\n        var eventInfo = { event: \"poll\", act: act, div_id: this.divid };\n        // log the response to the database\n        this.logBookEvent(eventInfo); // in bookfuncs.js\n        // log the fact that the user has answered the poll to local storage\n        let onlineResponse = \"Thanks, your response has been recorded\";\n        let offlineResponse = \"Thanks, your answers are not recorded\";\n        let onlineUpdate = \"Only Your last reponse is recorded\";\n        let offlineUpdate = \"Thanks, your answers are not recorded\";\n        localStorage.setItem(this.divid, \"true\");\n        if (!document.getElementById(`${this.divid}_sent`)) {\n            const span = document.createElement(\"span\");\n            span.id = `${this.divid}_sent`;\n            span.innerHTML = `<strong>${eBookConfig.useRunestoneServices ? onlineResponse : offlineResponse}</strong>`;\n            this.pollForm.appendChild(span);\n        } else {\n            const sentEl = document.getElementById(`${this.divid}_sent`);\n            sentEl.innerHTML = `<strong>${eBookConfig.useRunestoneServices ? onlineUpdate : offlineUpdate}</strong>`;\n        }\n        // show the results of the poll\n        if (this.resultsViewer === \"all\") {\n            var data = {};\n            data.div_id = this.divid;\n            data.course = eBookConfig.course;\n            try {\n                const params = new URLSearchParams(data);\n                const resp = await fetch(`${eBookConfig.new_server_prefix}/assessment/getpollresults?${params.toString()}`);\n                const json = await resp.json();\n                this.showPollResults(json);\n            } catch (e) {\n                this.indicate_component_ready();\n            }\n        }\n    }\n    showPollResults(results) {\n        //displays the results returned by the server\n        results = results.detail;\n        var total = results[\"total\"];\n        var optCounts = results[\"opt_counts\"];\n        var div_id = results[\"div_id\"];\n        var my_vote = results[\"my_vote\"];\n        // restore current users vote\n        if (my_vote > -1) {\n            this.optsArray[my_vote].checked = true;\n        }\n        // show results summary if appropriate\n        if (\n            (this.resultsViewer === \"all\" &&\n                localStorage.getItem(this.divid) === \"true\") ||\n            eBookConfig.isInstructor\n        ) {\n            this.resultsDiv.innerHTML = `<b>Results:</b> ${total} responses <br><br>`;\n            var list = document.createElement(\"div\");\n            list.classList.add(\"results-container\");\n            for (var i = 0; i < this.optionList.length; i++) {\n                var count;\n                var percent;\n                if (optCounts[i] > 0) {\n                    count = optCounts[i];\n                    percent = (count / total) * 100;\n                } else {\n                    count = 0;\n                    percent = 0;\n                }\n                var text = count + \" (\" + Math.round(10 * percent) / 10 + \"%)\"; // round percent to 10ths\n                let progressCounterEl = document.createElement(\"div\");\n                progressCounterEl.className = \"progresscounter\";\n                progressCounterEl.innerText = `${i + 1}. `;\n                let progressBarEl = document.createElement(\"div\");\n                let progressBarHTML = \"\";\n                if (percent > 10) {\n                    progressBarHTML =\n                        \"<div class='progress'>\" +\n                        \"<div class='progress-bar progress-bar-success'\" +\n                        `style=\"width: ${percent}%; min-width: 2em;\">` +\n                        \"<span class='poll-text'>\" +\n                        text +\n                        \"</span></div></div>\";\n                } else {\n                    progressBarHTML =\n                        \"<div class='progress'>\" +\n                        \"<div class='progress-bar progress-bar-success'\" +\n                        `style=\"width: ${percent}%; min-width: 2em;\"></div>` +\n                        \"<span class='poll-text' style='margin: 0 0 0 10px;'>\" +\n                        text +\n                        \"</span></div>\";\n                }\n                progressBarEl.innerHTML = progressBarHTML;\n                list.appendChild(progressCounterEl);\n                list.appendChild(progressBarEl);\n            }\n            this.resultsDiv.appendChild(list);\n        }\n        this.indicate_component_ready();\n    }\n    disableOptions() { }\n    async checkPollStorage() {\n        //checks the localstorage to see if the poll has been completed already\n        var _this = this;\n        var len = localStorage.length;\n        if (len > 0) {\n            //If the poll has already been completed, show the results\n            var data = {};\n            data.div_id = this.divid;\n            data.course = eBookConfig.course;\n            try {\n                const params = new URLSearchParams(data);\n                const resp = await fetch(`${eBookConfig.new_server_prefix}/assessment/getpollresults?${params.toString()}`);\n                const json = await resp.json();\n                this.showPollResults(json);\n            } catch (e) {\n                this.indicate_component_ready();\n            }\n        } else {\n            this.indicate_component_ready();\n        }\n    }\n}\n\n// Do not render poll data until login-complete event so we know instructor status\ndocument.addEventListener(\"runestone:login-complete\", function () {\n    document.querySelectorAll(\"[data-component=poll]\").forEach(function (el, index) {\n        try {\n            window.componentMap[el.id] = new Poll({ orig: el });\n        } catch (err) {\n            console.log(`Error rendering Poll Problem ${el.id}\n                         Details: ${err}`);\n            console.log(err.stack);\n        }\n    });\n});\n\nif (typeof window.component_factory === \"undefined\") {\n    window.component_factory = {};\n}\nwindow.component_factory.poll = function (opts) {\n    return new Poll(opts);\n};\n"],"names":["Poll","constructor","opts","super","orig","this","origElem","divid","id","children","childNodes","optionList","optsArray","comment","hasAttribute","resultsViewer","getAttribute","getQuestionText","getOptionText","renderPoll","checkPollStorage","caption","addCaption","firstAnswer","i","length","tagName","delimiter","outerHTML","temp","innerHTML","split","question","_this","push","containerDiv","document","createElement","pollForm","resultsDiv","classList","add","origClass","filter","Boolean","method","action","onsubmit","pollFieldset","appendChild","label","radio","tmpid","name","type","value","addEventListener","submitPoll","bind","prepend","renderTextField","replaceWith","queueMathJax","textfield","style","width","placeholder","poll_val","checked","comment_val","eventInfo","event","act","div_id","logBookEvent","localStorage","setItem","getElementById","eBookConfig","useRunestoneServices","span","data","course","params","URLSearchParams","resp","fetch","new_server_prefix","toString","json","showPollResults","e","indicate_component_ready","results","total","detail","optCounts","my_vote","getItem","isInstructor","list","count","percent","text","Math","round","progressCounterEl","className","innerText","progressBarEl","progressBarHTML","disableOptions","querySelectorAll","forEach","el","index","window","componentMap","err","console","log","stack","component_factory","poll"],"sourceRoot":""}