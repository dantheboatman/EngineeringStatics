{"version":3,"file":"819.fa7785b520e523a5.js","mappings":"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","sources":["webpack://WebComponents/./runestone/shortanswer/js/shortanswer.js","webpack://WebComponents/./runestone/shortanswer/js/timed_shortanswer.js"],"sourcesContent":["/*==========================================\n=======    Master shortanswer.js    ========\n============================================\n===     This file contains the JS for    ===\n=== the Runestone shortanswer component. ===\n============================================\n===              Created by              ===\n===           Isaiah Mayerchak           ===\n===                7/2/15                ===\n===              Brad Miller             ===\n===                2019                  ===\n==========================================*/\n\nimport RunestoneBase from \"../../common/js/runestonebase.js\";\nimport { looksLikeLatexMath } from \"../../common/js/bookfuncs.js\";\nimport \"./../css/shortanswer.css\";\n\nexport default class ShortAnswer extends RunestoneBase {\n    constructor(opts) {\n        super(opts);\n        if (opts) {\n            var orig = opts.orig; // entire <p> element that will be replaced by new HTML\n            this.useRunestoneServices =\n                opts.useRunestoneServices || eBookConfig.useRunestoneServices;\n            this.origElem = orig;\n            this.divid = orig.id;\n            this.question = this.origElem.innerHTML;\n            this.optional = false;\n            this.attachURL = opts.attachURL;\n            if (this.origElem.hasAttribute(\"data-optional\")) {\n                this.optional = true;\n            }\n            if (this.origElem.hasAttribute(\"data-attachment\")) {\n                this.attachment = true;\n            }\n            this.placeholder =\n                this.origElem.getAttribute(\"data-placeholder\") ||\n                \"Write your answer here\";\n            this.renderHTML();\n            this.caption = \"shortanswer\";\n            this.addCaption(\"runestone\");\n            this.checkServer(\"shortanswer\", true);\n            if (typeof Prism !== \"undefined\") {\n                Prism.highlightAllUnder(this.containerDiv);\n            }\n            if (this.attachment) {\n                this.getAttachmentName();\n            }\n        }\n    }\n\n    renderHTML() {\n        this.containerDiv = document.createElement(\"div\");\n        this.containerDiv.id = this.divid;\n        this.containerDiv.classList.add(...(this.origElem.getAttribute(\"class\") || \"\").split(\" \").filter(Boolean));\n        this.newForm = document.createElement(\"form\");\n        this.newForm.id = this.divid + \"_journal\";\n        this.newForm.name = this.newForm.id;\n        this.newForm.action = \"\";\n        this.containerDiv.appendChild(this.newForm);\n        this.fieldSet = document.createElement(\"fieldset\");\n        this.newForm.appendChild(this.fieldSet);\n        this.firstLegendDiv = document.createElement(\"div\");\n        this.firstLegendDiv.innerHTML = this.question;\n        this.firstLegendDiv.classList.add(\"journal-question\");\n        this.firstLegendDiv.classList.add(\"exercise-statement\");\n        this.fieldSet.appendChild(this.firstLegendDiv);\n        this.jInputDiv = document.createElement(\"div\");\n        this.jInputDiv.id = this.divid + \"_journal_input\";\n        this.fieldSet.appendChild(this.jInputDiv);\n        this.jOptionsDiv = document.createElement(\"div\");\n        this.jOptionsDiv.classList.add(\"journal-options\");\n        this.jInputDiv.appendChild(this.jOptionsDiv);\n        this.jTextArea = document.createElement(\"textarea\");\n        this.jTextArea.id = this.divid + \"_solution\";\n        this.jTextArea.setAttribute(\"aria-label\", \"textarea\");\n        this.jTextArea.placeholder = this.placeholder;\n        this.jTextArea.style.display = \"inline\";\n        this.jTextArea.style.width = \"530px\";\n        this.jTextArea.classList.add(\"form-control\");\n        this.jTextArea.rows = 4;\n        this.jTextArea.cols = 50;\n        this.jOptionsDiv.appendChild(this.jTextArea);\n\n        // fires when we loose focus on the textarea after making a change\n        // mark it as answered for peer/timed purposes\n        this.jTextArea.onchange = function () {\n            this.isAnswered = true;\n        }.bind(this);\n\n        // the answer has not been saved yet. Update as soon as user types in\n        // the box, not just when they loose focus.\n        this.jTextArea.addEventListener(\"keydown\", () => {\n            if (this.isTimed) {\n                // no need for danger status... nothing for user to do here\n                this.feedbackDiv.innerHTML = \"Your answer is automatically saved.\";\n            } else {\n                this.feedbackDiv.innerHTML = \"Your answer has not been saved yet!\";\n                this.feedbackDiv.classList.remove(\"alert-success\");\n                this.feedbackDiv.classList.add(\"alert\", \"alert-danger\");\n            }\n        });\n\n        this.jTextArea.addEventListener(\"input\", () => {\n            this.jTextArea.style.height = \"auto\";\n            this.jTextArea.style.height = `${this.jTextArea.scrollHeight}px`;\n            this.renderMath(this.jTextArea.value);\n        });\n        this.buttonDiv = document.createElement(\"div\");\n        this.fieldSet.appendChild(this.buttonDiv);\n        this.submitButton = document.createElement(\"button\");\n        this.submitButton.classList.add(\"btn\", \"btn-success\");\n        this.submitButton.type = \"button\";\n        this.submitButton.textContent = \"Save\";\n        this.submitButton.onclick = function () {\n            this.checkCurrentAnswer();\n            this.logCurrentAnswer();\n            this.renderFeedback();\n        }.bind(this);\n        this.buttonDiv.appendChild(this.submitButton);\n\n        this.otherOptionsDiv = document.createElement(\"div\");\n        this.otherOptionsDiv.style.paddingLeft = \"20px\";\n        this.otherOptionsDiv.classList.add(\"journal-options\");\n        this.fieldSet.appendChild(this.otherOptionsDiv);\n        // add a feedback div to give user feedback\n        this.feedbackDiv = document.createElement(\"div\");\n        this.feedbackDiv.style.width = \"530px\";\n        this.feedbackDiv.style.fontStyle = \"italic\";\n        this.feedbackDiv.id = this.divid + \"_feedback\";\n        this.feedbackDiv.classList.add(\"shortanswer__feedback\");\n        this.feedbackDiv.style.display = \"none\";\n        this.fieldSet.appendChild(this.feedbackDiv);\n        if (this.attachment) {\n            let attachDiv = document.createElement(\"div\")\n            this.attachDiv = attachDiv;\n            if (this.graderactive) {\n                // If in grading mode make a button to create a popup with the image\n                let viewButton = document.createElement(\"button\")\n                viewButton.type = \"button\"\n                viewButton.innerHTML = \"View Attachment\"\n                viewButton.onclick = this.viewFile.bind(this);\n                attachDiv.appendChild(viewButton);\n            } else {\n                // Otherwise make a button for the student to select a file to upload.\n                this.fileUpload = document.createElement(\"input\")\n                this.fileUpload.type = \"file\";\n                this.fileUpload.id = `${this.divid}_fileme`;\n                attachDiv.appendChild(this.fileUpload);\n            }\n            this.containerDiv.appendChild(attachDiv);\n        }\n        this.origElem.replaceWith(this.containerDiv);\n        // This is a stopgap measure for when MathJax is not loaded at all.  There is another\n        // more difficult case that when MathJax is loaded asynchronously we will get here\n        // before MathJax is loaded.  In that case we will need to implement something\n        // like `the solution described here <https://stackoverflow.com/questions/3014018/how-to-detect-when-mathjax-is-fully-loaded>`_\n        if (typeof MathJax !== \"undefined\") {\n            this.queueMathJax(this.containerDiv);\n        }\n    }\n\n    renderMath(value) {\n        if (looksLikeLatexMath(value)) {\n            if (!this.renderedAnswer) {\n                this.rederedAnswerDiv = document.createElement(\"div\");\n                this.rederedAnswerDiv.classList.add(\"shortanswer__rendered-answer-div\");\n                this.fieldSet.appendChild(this.rederedAnswerDiv);\n\n                this.renderedAnswerLabel = document.createElement(\"label\");\n                this.renderedAnswerLabel.innerHTML = \"Rendered Answer:\";\n                this.renderedAnswerLabel.id = this.divid + \"_rendered_answer_label\";\n                this.renderedAnswerLabel.classList.add(\"shortanswer__rendered-answer-label\");\n                this.rederedAnswerDiv.appendChild(this.renderedAnswerLabel);\n\n                this.renderedAnswer = document.createElement(\"div\");\n                this.renderedAnswer.classList.add(\"shortanswer__rendered-answer\");\n                this.renderedAnswer.classList.add(\"latexoutput\");\n                this.renderedAnswer.setAttribute('aria-labelledby', this.renderedAnswerLabel.id);\n                this.renderedAnswer.setAttribute('aria-live', \"polite\");\n                this.rederedAnswerDiv.appendChild(this.renderedAnswer);\n            }\n            value = value.replace(/\\$\\$(.*?)\\$\\$/g, \"\\\\[ $1 \\\\]\");\n            value = value.replace(/\\$(.*?)\\$/g, \"\\\\( $1 \\\\)\");\n            value = value.replace(/\\n/g, \"<br/>\");\n            this.renderedAnswer.innerHTML = value;\n\n            this.rederedAnswerDiv.style.display = \"block\";\n            this.queueMathJax(this.renderedAnswer);\n\n        } else {\n            if (this.renderedAnswer) {\n                this.rederedAnswerDiv.style.display = \"none\";\n            }\n        }\n    }\n\n    async checkCurrentAnswer() {\n        let value = document.getElementById(this.divid + \"_solution\").value;\n        this.renderMath(value);\n        this.setLocalStorage({\n            answer: value,\n            timestamp: new Date(),\n        });\n    }\n\n    async logCurrentAnswer(sid) {\n        let value = document.getElementById(this.divid + \"_solution\").value;\n        this.renderMath(value);\n        this.setLocalStorage({\n            answer: value,\n            timestamp: new Date(),\n        });\n        let data = {\n            event: \"shortanswer\",\n            act: value,\n            answer: value,\n            div_id: this.divid,\n        };\n        if (typeof sid !== \"undefined\") {\n            data.sid = sid;\n        }\n        await this.logBookEvent(data);\n        if (this.attachment) {\n            await this.uploadFile();\n        }\n    }\n\n    renderFeedback() {\n        this.feedbackDiv.innerHTML = \"Your answer has been saved.\";\n        this.feedbackDiv.classList.remove(\"alert-danger\");\n        this.feedbackDiv.classList.add(\"alert\", \"alert-success\");\n        this.feedbackDiv.style.display = \"block\";\n    }\n    setLocalStorage(data) {\n        if (!this.graderactive) {\n            let key = this.localStorageKey();\n            localStorage.setItem(key, JSON.stringify(data));\n        }\n    }\n    checkLocalStorage() {\n        // Repopulates the short answer text\n        // which was stored into local storage.\n        var answer = \"\";\n        if (this.graderactive) {\n            return;\n        }\n        var len = localStorage.length;\n        if (len > 0) {\n            var ex = localStorage.getItem(this.localStorageKey());\n            if (ex !== null) {\n                try {\n                    var storedData = JSON.parse(ex);\n                    answer = storedData.answer;\n                } catch (err) {\n                    // error while parsing; likely due to bad value stored in storage\n                    console.log(err.message);\n                    localStorage.removeItem(this.localStorageKey());\n                    return;\n                }\n                let solution = document.getElementById(this.divid + \"_solution\");\n                if (solution) {\n                    solution.value = answer;\n                }\n                this.renderMath(answer);\n            }\n        }\n    }\n    restoreAnswers(data) {\n        // Restore answers from storage retrieval done in RunestoneBase\n        // sometimes data.answer can be null\n        if (!data.answer) {\n            data.answer = \"\";\n        }\n        this.answer = data.answer;\n        this.jTextArea.value = this.answer;\n        this.renderMath(this.answer);\n\n        let p = document.createElement(\"p\");\n        p.classList.add(\"shortanswer__timestamp\");\n        this.jInputDiv.appendChild(p);\n        var tsString = \"\";\n        if (data.timestamp) {\n            tsString = new Date(data.timestamp).toLocaleString();\n        } else {\n            tsString = \"\";\n        }\n        p.textContent = tsString;\n        this.jTextArea.style.height = \"auto\";\n        this.jTextArea.style.height = `${this.jTextArea.scrollHeight}px`;\n\n        if (data.last_answer) {\n            this.current_answer = \"ontime\";\n            let toggle_answer_button = document.createElement(\"button\");\n            toggle_answer_button.type = \"button\";\n            toggle_answer_button.textContent = \"Show Late Answer\";\n            toggle_answer_button.classList.add(\"btn\", \"btn-warning\");\n            toggle_answer_button.style.marginLeft = \"5px\";\n\n            toggle_answer_button.addEventListener(\n                \"click\",\n                function () {\n                    var display_timestamp, button_text;\n                    if (this.current_answer === \"ontime\") {\n                        this.jTextArea.value = data.last_answer;\n                        this.answer = data.last_answer;\n                        display_timestamp = new Date(\n                            data.last_timestamp\n                        ).toLocaleString();\n                        button_text = \"Show on-Time Answer\";\n                        this.current_answer = \"late\";\n                    } else {\n                        this.jTextArea.value = data.answer;\n                        this.answer = data.answer;\n                        display_timestamp = tsString;\n                        button_text = \"Show Late Answer\";\n                        this.current_answer = \"ontime\";\n                    }\n                    this.renderMath(this.answer);\n                    p.textContent = `Submitted: ${display_timestamp}`;\n                    toggle_answer_button.textContent = button_text;\n                }.bind(this)\n            );\n\n            this.buttonDiv.appendChild(toggle_answer_button);\n        }\n        let feedbackStr = \"\";\n        if (typeof data.score !== \"undefined\") {\n            feedbackStr = `Score: ${data.score}`;\n        }\n        if (data.comment) {\n            feedbackStr += ` -- ${data.comment}`;\n        }\n        if (feedbackStr !== \"\") {\n            this.feedbackDiv.innerHTML = feedbackStr;\n            this.feedbackDiv.style.display = \"block\";\n            this.feedbackDiv.classList.add(\"alert\", \"alert-success\");\n        }\n    }\n\n    disableInteraction() {\n        this.jTextArea.disabled = true;\n    }\n\n    async getAttachmentName() {\n        // Get the attachment name from the /ns/assessment/has_attachment endpoint\n        let requestUrl = `/ns/assessment/has_attachment/${this.divid}`;\n        if (this.sid) {\n            requestUrl += `?sid=${this.sid}`;\n        }\n        const response = await fetch(requestUrl);\n        if (!response.ok) {\n            console.error(\"Error fetching attachment name:\", response.statusText);\n            return null;\n        }\n        const obj = await response.json();\n        if (obj.detail.hasAttachment) {\n            // Return the S3 key for the attachment\n            let filename = obj.detail.hasAttachment;\n            // filename is everthing after the last slash\n            filename = filename.substring(filename.lastIndexOf(\"/\") + 1);\n            let fmess = document.createElement(\"span\");\n            fmess.innerHTML = `Attachment: ${filename}`;\n            this.attachDiv.appendChild(fmess);\n        }\n    }\n\n    async uploadFile() {\n        const files = this.fileUpload.files\n        // get the suffix from the file name\n        const fileName = files[0].name;\n        const suffix = fileName.split('.').pop();\n        // if the suffix is not in the list of allowed suffixes, return\n        if (!['jpg', 'jpeg', 'png', 'gif', 'pdf'].includes(suffix)) {\n            alert(\"File type not allowed. Please upload a jpg, jpeg, png, gif, or pdf file.\");\n            return;\n        }\n        // if the file size is greater than 5MB, return\n        if (files[0].size > 5 * 1024 * 1024) {\n            alert(\"File size exceeds 5MB limit. Please upload a smaller file.\");\n            return;\n        }\n        const data = new FormData()\n        if (this.fileUpload.files.length > 0) {\n            data.append('file', files[0])\n            fetch(`/ns/logger/upload/${this.divid}`, {\n                method: 'POST',\n                body: data\n            })\n                .then(response => response.json())\n                .then(data => {\n                    console.log(data)\n                })\n                .catch(error => {\n                    console.error(error)\n                })\n        }\n    }\n\n    viewFile() {\n        // Get the URL from the S3 API -- saved when we display in grader mode\n        if (this.attachURL) {\n            //window.open(this.attachURL, \"_blank\");\n            //<embed src=\"example.pdf\" type=\"application/pdf\" width=\"100%\" height=\"600px\" />\n            //switch to \n            const image_window = window.open(\"\", \"_blank\")\n            if (this.attachURL.indexOf('.pdf?') !== -1) {\n                const embed = image_window.document.createElement(\"object\");\n                embed.setAttribute(\"data\", this.attachURL);\n                embed.setAttribute(\"type\", \"application/pdf\");\n                embed.setAttribute(\"width\", \"800px\");\n                embed.setAttribute(\"height\", \"1040px\");\n                image_window.document.body.appendChild(embed);\n                let alt = image_window.document.createElement(\"a\");\n                alt.setAttribute(\"href\", this.attachURL);\n                alt.innerText = \"Download PDF\";\n                embed.appendChild(alt);\n            }\n            else {\n                const img = image_window.document.createElement(\"img\");\n                img.setAttribute(\"src\", this.attachURL);\n                img.setAttribute(\"style\", \"width:100%; height:auto;\");\n                image_window.document.body.appendChild(img);\n            }\n        } else {\n            alert(\"No attachment for this student.\")\n        }\n    }\n}\n\n/*=================================\n== Find the custom HTML tags and ==\n==   execute our code on them    ==\n=================================*/\ndocument.addEventListener(\"runestone:login-complete\", function () {\n    document.querySelectorAll(\"[data-component=shortanswer]\").forEach(function (el) {\n        // If this element exists within a timed component, don't render it here\n        if (!el.closest(\"[data-component=timedAssessment]\")) {\n            try {\n                window.componentMap[el.id] = new ShortAnswer({\n                    orig: el,\n                    useRunestoneServices: eBookConfig.useRunestoneServices,\n                });\n            } catch (err) {\n                console.log(`Error rendering ShortAnswer Problem ${el.id}\n                Details: ${err}`);\n            }\n        }\n    });\n});\n","import ShortAnswer from \"./shortanswer.js\";\n\nexport default class TimedShortAnswer extends ShortAnswer {\n    constructor(opts) {\n        super(opts);\n        this.renderTimedIcon(this.containerDiv);\n        this.isTimed = true;\n        this.hideButtons();\n    }\n    hideButtons() {\n        if (this.submitButton) {\n            this.submitButton.style.display = \"none\";\n        }\n    }\n    renderTimedIcon(component) {\n        // renders the clock icon on timed components.    The component parameter\n        // is the element that the icon should be appended to.\n        var timeIconDiv = document.createElement(\"div\");\n        var timeIcon = document.createElement(\"img\");\n\n        timeIcon.src = \"../_static/clock.png\";\n        timeIcon.style.width = \"15px\";\n        timeIcon.style.height = \"15px\";\n\n        timeIconDiv.className = \"timeTip\";\n        timeIconDiv.title = \"\";\n        timeIconDiv.appendChild(timeIcon);\n\n        // If firstChild is null, insertBefore acts like appendChild\n        component.insertBefore(timeIconDiv, component.firstChild);\n    }\n    checkCorrectTimed() {\n        return \"I\"; // we ignore this in the grading\n    }\n    hideFeedback() {\n        if (this.feedbackDiv) {\n            this.feedbackDiv.style.display = \"none\";\n        }\n    }\n}\n\nif (typeof window.component_factory === \"undefined\") {\n    window.component_factory = {};\n}\n\nwindow.component_factory.shortanswer = function (opts) {\n    if (opts.timed) {\n        return new TimedShortAnswer(opts);\n    }\n    return new ShortAnswer(opts);\n};\n"],"names":["ShortAnswer","constructor","opts","super","orig","this","useRunestoneServices","eBookConfig","origElem","divid","id","question","innerHTML","optional","attachURL","hasAttribute","attachment","placeholder","getAttribute","renderHTML","caption","addCaption","checkServer","Prism","highlightAllUnder","containerDiv","getAttachmentName","document","createElement","classList","add","split","filter","Boolean","newForm","name","action","appendChild","fieldSet","firstLegendDiv","jInputDiv","jOptionsDiv","jTextArea","setAttribute","style","display","width","rows","cols","onchange","isAnswered","bind","addEventListener","isTimed","feedbackDiv","remove","height","scrollHeight","renderMath","value","buttonDiv","submitButton","type","textContent","onclick","checkCurrentAnswer","logCurrentAnswer","renderFeedback","otherOptionsDiv","paddingLeft","fontStyle","attachDiv","graderactive","viewButton","viewFile","fileUpload","replaceWith","MathJax","queueMathJax","renderedAnswer","rederedAnswerDiv","renderedAnswerLabel","replace","getElementById","setLocalStorage","answer","timestamp","Date","sid","data","event","act","div_id","logBookEvent","uploadFile","key","localStorageKey","localStorage","setItem","JSON","stringify","checkLocalStorage","length","ex","getItem","parse","err","console","log","message","removeItem","solution","restoreAnswers","p","tsString","toLocaleString","last_answer","current_answer","toggle_answer_button","marginLeft","display_timestamp","button_text","last_timestamp","feedbackStr","score","comment","disableInteraction","disabled","requestUrl","response","fetch","ok","error","statusText","obj","json","detail","hasAttachment","filename","substring","lastIndexOf","fmess","files","suffix","pop","includes","alert","size","FormData","append","method","body","then","catch","image_window","window","open","indexOf","embed","alt","innerText","img","querySelectorAll","forEach","el","closest","componentMap","TimedShortAnswer","renderTimedIcon","hideButtons","component","timeIconDiv","timeIcon","src","className","title","insertBefore","firstChild","checkCorrectTimed","hideFeedback","component_factory","shortanswer","timed"],"sourceRoot":""}